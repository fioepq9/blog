---
title: MySQL面试题
date: 2022-04-06 16:41:21
tags:
  - MySQL
categories:
  - 面试题
---

## 事务的ACID

+ 原子性(atomicity)

一个事务必须被视为一个不可分割的最小工作单元，整个事务中的所有操作要么全部提交成功，要么全部失败回滚。对于一个事务来说，不可能只执行其中的一部分操作。

+ 一致性(consistency)

事务要保证数据库总是从一个一致性的状态转换到另一个一致性的状态。事务成功则整体修改，事务失败则全部回滚。

+ 隔离性(isolation)

通常来说，一个事务所做的修改在最终提交以前，对其他事务是不可见的。

+ 持久性(durability)

一旦事务提交，则其所做的修改就会永久保存到数据库中。此时即使系统崩溃，修改的数据也不会丢失。

### 隔离级别

+ READ UNCOMMITED(未提交读)

在这一级别，事务中的修改，即使没有提交，对其他事务也是可见的。

这一级别会出现脏读的现象，即读取其他事务未提交的数据。

+ READ COMMITED(提交读)

在这一级别，一个事务开始时，只能“看见”已经提交的事务所做的修改。

这一级别避免了脏读，但仍会出现不可重复读的现象，即在一个事务读取同一条记录可能会获取到不同的结果。

+ REPEATABLE READ(可重复读)

在这一级别，可以确保同一个事务在多次读取一个数据时得到相同的结果，同时也是MySQL的Innodb引擎事务的默认隔离级别。这一级别解决了不可重复读，但仍会出现幻读的现象。幻读，指的是当A事务在读取某个范围内的记录时，B事务又在该范围内插入了新的记录。A事务再次读取该范围内的记录时，就会得到不一致的结果。InnoDB通过引入MVCC机制，解决了幻读的问题。

+ SERIALIZABLE(可串行化)

这一级别强制事务串行执行，使事务不可能相互冲突，解决了幻读的问题。但可能导致大量的超时现象和锁竞争，实际很少使用。

### 什么是MVCC？

MVCC，也就是多版本并发控制；可以认为MVCC是行级锁的一个变种，它在很多情况下避免了加锁操作，因此开销更低。虽然在各种数据库的实现机制有所不同，但大都实现了非阻塞的读操作，写操作也只锁定必要的行。

InnoDB的MVCC，是通过在每行记录后面保存两个隐藏列来实现的。这两个列，一个保存了行的创建版本号，一个保存行的删除版本号。在InnoDB中，每开始一个新事务，系统版本号都会自动递增。

+ 优点：这样设计使得数据操作很简单，性能很好，并且也能保证只会读取到符合标准的行。
+ 缺点：每行记录都需要额外的存储空间，需要做更多的行检查工作，以及一些额外的维护工作。

## 数据库三大范式？

+ 第一范式：表中的每一列应该是不可再分的最小单元，即确保每列都保持原子性。

在第一范式中的最小单元的定义应该根据实际需求确定。例如一些查询只需要用到“地址”字段，那么“地址”字段就是原子的；但如果需要用到“地址”中的“城市”部分，那么就需要将“地址”列拆分。

+ 第二范式：每个非主键列应该完全与主键有关，而不能只与主键部分相关。

也就是说，在一个表中，只能保存一种数据，不可以将多种数据保存在同一个数据表中。比如，一个表中，学号和课程是联合主键，其它列有学生姓名和成绩。这个表就不符合第二范式，学生姓名只跟学号相关，应该将学号和学生姓名分成另一张表。

+ 第三范式：每列都和主键列直接相关，而不是间接相关。

比如，一个表中，主键是学号，其它列有是姓名、院系、院长名。这之中，院长名跟院系是直接相关的，院系跟学号是直接相关的，也就是说院长名跟学号间接相关。这个表就不符合第三范式，应该将院系和院长名单独分出一张表，并将院系作为外键约束。

## 表连接方式？

+ 内连接：仅将两个表中满足连接条件的行组合起来作为结果集。
+ 外连接，包括
   + 左连接：左边表的所有数据全部显示，右边表显示满足连接条件的部分，没有对应部分的填充NULL。
   + 右连接：跟左连接基本相同，只有方向不同。
   + 全外连接：查询出两表中的所有记录，但去除重复记录。
+ 交叉连接：返回两表记录的笛卡尔积。
+ 自连接：指发生在一张基表上的连接。

## 数据库索引的实现原理

InnoDB使用B+树作为索引的内部实现。B+树是一种多路平衡树，一棵m阶的B+树有以下特点：
+ 每个结点最多有m-1个键。
+ 根结点至少有一个键，非根结点至少有m/2个键。
+ 每个结点中的键升序排列，每个键的左子树中的所有键都小于它，右子树中的所有键都大于等于它。
+ 所有叶子结点位于同一层，即根节点到每个叶子结点的高度相同。
+ 只有叶子节点保存数据，同时所有叶子节点构成一个链表。

### 对比B树，B+树有哪些优点？

+ IO次数更少：由于B+树的中间结点只保存索引，数据都存放在叶子结点中，因此一次IO可以查询更多的索引，整棵树更加矮胖。
+ 范围查询效率更高：B+树的叶子结点构成一个链表，在进行范围查询的时候，只需要找到第一个记录就可以通过遍历链表获取到查询结果。
+ 查询效率更加稳定：B+树每次查询都必定要查询到叶子结点。

### 使用索引的优缺点

优点：
+ 索引大大减少了需要扫描的数据量。
+ 索引可以避免排序和临时表。
+ 索引可以将随机I/O变为顺序I/O。

缺点：
+ 建立和维护索引需要耗费额外的空间和时间。

## int(6)和int(11)的区别？

底层无区别，外部约束。

## 什么时候会使用MySQL？

需要用到事务的时候。关系型数据库强调ACID规则（原子性（Atomicity）、一致性（Consistency）、隔离性（Isolation）、持久性（Durability）），可以满足对事务性要求较高或者需要进行复杂数据查询的数据操作，而且可以充分满足数据库操作的高性能和操作稳定性的要求。并且关系型数据库十分强调数据的强一致性，对于事务的操作有很好的支持。关系型数据库可以控制事务原子性细粒度，并且一旦操作有误或者有需要，可以马上回滚事务。

